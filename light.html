<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>灯光</title>
		<style>
			#canvas-frame {
				width: 100%;
				height: 600px;
				background-color: #EEEEEE;
			}	
		</style>
		<script type="text/javascript" src="js/three.min.js"></script>
		<script type="text/javascript" src="js/clock.js"></script>
		<script src="js/TrackballControls.js"></script>
		<script src="js/Stats.js"></script>
		<script src="js/loader/OBJLoader.js"></script>
		<script type="text/javascript">
			var width, height;
			var scene, camera, renderer, light, controls;
			var texture;
			var ball, plane;
			var radius = 10;
			var stats;
			var v = 0;
			var a = -0.1;
			var isMoving = false;
			function init(){
				width = document.getElementById("canvas-frame").clientWidth;
				height = document.getElementById("canvas-frame").clientHeight;
				//渲染器
				renderer = new THREE.WebGLRenderer();
				renderer.setSize(width, height);
				renderer.setClearColor(0x000000, 1.0);
				document.getElementById("canvas-frame").appendChild(renderer.domElement);
				//FPS
				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.left = '0px';
				stats.domElement.style.top = '0px';
				stats.domElement.style.width = '90px';
				document.getElementById("canvas-frame").appendChild(stats.domElement);
				//舞台
				scene = new THREE.Scene({
			         antialias : true
		      	});
				//相机
				camera = new THREE.PerspectiveCamera(75, width/height, 0.1, 10000);
//				camera = new THREE.OrthographicCamera(-width/2, width/2, height/2, -height/2, 0.1, 10000);
				camera.position.x = 100;
				camera.position.y = 100;
				camera.position.z = 500;
				camera.up.x = 0;
				camera.up.y = 1;
				camera.up.z = 0;
				camera.lookAt({x : 0, y : 0, z : 0});
				scene.add(camera);
				var dirLight = new THREE.DirectionalLight( 0xffffff );
				dirLight.position.set( 200, 200, 1000 ).normalize();

				camera.add( dirLight );
				camera.add( dirLight.target );
				//控制器
				controls = new THREE.TrackballControls( camera );

		       	controls.rotateSpeed = 5.0;
		       	controls.zoomSpeed = 5;
		       	controls.panSpeed = 2;
		
		       	controls.noZoom = false;
		       	controls.noPan = false;
		
		       	controls.staticMoving = true;
		       	controls.dynamicDampingFactor = 0.3;
				//灯光
				light = new THREE.AmbientLight(0xFFFFFF);
				light.position.set(100, 100, 200);
		//		scene.add(light);
				light = new THREE.PointLight(0xFFFFFF);
				light.position.set(1500, 100, 200);
		//		scene.add(light);
				light = new THREE.DirectionalLight(0xFFFFFF);
				light.position.set(-100, 100, -200);
		//		scene.add(light);
				light = new THREE.SpotLight(0xFFFFFF, 1, 100, Math.PI/9, 25);
				light.target.position.set(0, 0,0);
				scene.add(light);
				//物体
				
				var material = new THREE.MeshLambertMaterial( { color: 0xffffff, side: THREE.DoubleSide } );

				var loader = new THREE.OBJLoader();
				loader.load("models/emerald.obj", function(obj){
					obj.traverse(function(child) {
				        if (child instanceof THREE.Mesh) {
				            child.material = new THREE.MeshLambertMaterial( { color: 0xff00ff, side: THREE.DoubleSide } );
				        }
				    });
					ball = obj;
					scene.add(ball);
				}, function ( xhr ) {
					console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
				}, function ( xhr ) {
					console.log( 'An error happened' );
				});
				
				

				console.log( canvas );
//				window.addEventListener( 'resize', onWindowResize, false );
				
			};
		    function onWindowResize() {
		        camera.aspect = window.innerWidth / window.innerHeight;
		        camera.updateProjectionMatrix();
		        renderer.setSize( window.innerWidth, window.innerHeight );
		    }
			function render(){
				controls.update();
				falling();
				stats.update();
				renderer.render(scene, camera);
				requestAnimationFrame(render);
			}
			function start(){
				Clock();
				init();
				render();
			}
			function drop(){
				isMoving = true;
				ball.position.y = 300;
				v = 0;
			}
			function falling(){
				if(isMoving){
					ball.position.y += v;
					v += a;
					
					if(ball.position.y <= radius){
						v = -v*0.9;
					}
					if(Math.abs(v) < 0.001){
						isMoving = false;
						ball.position.y = radius;
					}
				}
			}
		</script>
	</head>
	<body onload="start();">
		<div id="canvas-frame"></div>
		<button onclick="drop();">开始</button>
	</body>
</html>